datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// --- USER & AUTHENTICATION ---
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  name          String?
  role          String    @default("CLIENT") // UserRole as string
  lastLogin     DateTime?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("users")
}

// --- CLIENT ---
model Client {
  id            String    @id @default(uuid())
  name          String
  email         String?
  phone         String?
  type          String    @default("INDIVIDUAL") // "COMPANY" or "INDIVIDUAL"
  tin           String?   // Tax Identification Number
  nis           String?   // National Insurance Scheme
  businessReg   String?   // Business Registration Number
  address       String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  filings       Filing[]
  properties    Property[]
  employees     Employee[]
  immigrationCases ImmigrationCase[]
  auditCases    AuditCase[]
  bankServices  BankService[]
  expediteJobs  ExpediteJob[]

  @@map("clients")
}

// --- FILING MANAGEMENT ---
model Filing {
  id            String    @id @default(uuid())
  clientId      String
  type          String    // "VAT_RETURN", "PAYE_RETURN", "CIT_RETURN"
  agency        String    @default("GRA") // "GRA", "NIS", "DCRA"
  status        String    @default("DRAFT") // "DRAFT", "SUBMITTED", "APPROVED", "REJECTED"
  amount        Float?
  dueDate       DateTime
  submittedAt   DateTime?
  period        String?   // e.g. "2024-Q1", "2024-01"
  reference     String?   // Agency reference number
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  client        Client    @relation(fields: [clientId], references: [id])

  @@map("filings")
}

// --- IMMIGRATION ---
model ImmigrationCase {
  id              String    @id @default(uuid())
  clientId        String
  caseType        String    // "WORK_PERMIT", "BUSINESS_VISA", "CITIZENSHIP"
  applicantName   String
  nationality     String?
  status          String    @default("TO_DO") // "TO_DO", "IN_PROGRESS", "REVIEW", "COMPLETED"
  applicationDate DateTime?
  expiryDate      DateTime?
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  client          Client    @relation(fields: [clientId], references: [id])

  @@map("immigration_cases")
}

// --- PROPERTY MANAGEMENT ---
model Property {
  id                       String    @id @default(uuid())
  clientId                 String
  address                  String
  propertyType             String    @default("APARTMENT") // "APARTMENT", "HOUSE", "COMMERCIAL"
  monthlyRent              Float
  managementFeePercentage  Float     @default(10.0)
  managementFee            Float     @default(0.0)
  tenantName               String?
  tenantPhone              String?
  leaseStart               DateTime?
  leaseExpiry              DateTime?
  arrears                  Float     @default(0.0)
  notes                    String?
  isActive                 Boolean   @default(true)
  createdAt                DateTime  @default(now())
  updatedAt                DateTime  @updatedAt

  client                   Client    @relation(fields: [clientId], references: [id])

  @@map("properties")
}

// --- PAYROLL & EMPLOYEES ---
model Employee {
  id            String    @id @default(uuid())
  clientId      String
  fullName      String
  nis           String?   // NIS Number
  tin           String?   // TIN Number
  position      String?
  salary        Float?
  allowances    Float?    @default(0)
  isActive      Boolean   @default(true)
  hiredDate     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  client        Client    @relation(fields: [clientId], references: [id])

  @@map("employees")
}

// --- AUDIT CASES ---
model AuditCase {
  id            String    @id @default(uuid())
  clientId      String
  entityName    String
  auditType     String    @default("NGO") // "NGO", "CO_OP"
  status        String    @default("INITIATED") // "INITIATED", "FIELDWORK", "REPORTING", "COMPLETED"
  timeline      String?   // JSON stored as text for SQLite
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  client        Client    @relation(fields: [clientId], references: [id])

  @@map("audit_cases")
}

// --- BANK SERVICES ---
model BankService {
  id            String    @id @default(uuid())
  clientId      String
  serviceType   String    // "ACCOUNT_OPENING", "LOAN_APPLICATION"
  bankName      String
  status        String    @default("INITIATED") // "INITIATED", "PROCESSING", "APPROVED", "REJECTED"
  amount        Float?    // For loans
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  client        Client    @relation(fields: [clientId], references: [id])

  @@map("bank_services")
}

// --- EXPEDITING ---
model ExpediteJob {
  id                      String    @id @default(uuid())
  clientId                String
  documentType            String    // "TAX_CLEARANCE", "CERTIFICATE", "LICENSE"
  agency                  String    // "GRA", "DEEDS", "IMMIGRATION"
  status                  String    @default("RECEIVED") // "RECEIVED", "PICKED_UP", "AT_AGENCY", "PROCESSING", "READY", "DELIVERED"
  assignedRunner          String?
  agencyReference         String?
  statusHistory           String?   // JSON stored as text for SQLite
  notes                   String?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  client                  Client    @relation(fields: [clientId], references: [id])

  @@map("expedite_jobs")
}